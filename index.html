<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TDRS - Truck Dispatch & Revenue System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <style>
    :root {
      --bg-color: #f0f4f8;
      --header-color: #2c3e50;
      --card-color: #ffffff;
      --accent-color: #3498db;
      --button-color: #3498db;
      --button-hover: #2980b9;
      --success-color: #27ae60;
      --warning-color: #e74c3c;
      --pending-color: #f39c12;
      --sent-color: #3498db;
      --paid-color: #27ae60;
      --overdue-color: #e74c3c;
      --wcv6-color: #8e44ad;
      --wcv4-color: #3498db;
      --text-color: #2c3e50;
      --subtle-text: #7f8c8d;
      --row-color1: #f8f9fa;
      --row-color2: #e9ecef;
      --status-bar-color: #d6dbdf;
      --operator-color: #9b59b6;
      --driver-color: #3498db;
      --bank-color: #27ae60;
      --phone-color: #e67e22;
      --specs-color: #8e44ad;
      --maintenance-color: #f39c12;
      --border-radius: 8px;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
      --soa-header: #2c3e50;
      --inactive-bg: #f8f9fa;
      --inactive-border: #e9ecef;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    /* Header Styles */
    header {
      background: linear-gradient(135deg, #2c3e50, #1a2530);
      color: white;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--box-shadow);
      z-index: 100;
      position: sticky;
      top: 0;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo i {
      color: var(--accent-color);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(to right, #3498db, #8e44ad);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .logout-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
    }

    .datetime {
      font-size: 13px;
      color: #e0e0e0;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 13px;
    }

    .indicator-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--success-color);
      box-shadow: 0 0 6px var(--success-color);
    }

    /* Control Panel */
    .control-panel {
      background: linear-gradient(to right, #f8f9fa, #e9ecef);
      padding: 12px 20px;
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      border-bottom: 1px solid #ddd;
    }

    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      box-shadow: var(--box-shadow);
    }

    .btn-primary {
      background: linear-gradient(to bottom, var(--button-color), #2a80b9);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(to bottom, var(--warning-color), #c0392b);
      color: white;
    }

    .btn-success {
      background: linear-gradient(to bottom, var(--success-color), #219653);
      color: white;
    }

    .btn-secondary {
      background: linear-gradient(to bottom, var(--subtle-text), #5d6d74);
      color: white;
    }

    .btn-warning {
      background: linear-gradient(to bottom, var(--pending-color), #e67e22);
      color: white;
    }

    .btn-operator {
      background: linear-gradient(to bottom, var(--operator-color), #8e44ad);
      color: white;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 15px 20px;
      display: flex;
      flex-direction: column;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 15px;
      flex-wrap: wrap;
      background-color: #f8f9fa;
      border-radius: var(--border-radius);
      padding: 4px;
    }

    .tab {
      padding: 10px 20px;
      cursor: pointer;
      background-color: #d6dbdf;
      border: 1px solid #ddd;
      border-bottom: none;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 110px;
      transition: var(--transition);
      font-size: 14px;
    }

    .tab:hover {
      background-color: #c8d0d8;
    }

    .tab.active {
      background-color: var(--card-color);
      border-bottom: 1px solid var(--card-color);
      margin-bottom: -1px;
      color: var(--accent-color);
    }

    .tab.active i {
      color: var(--accent-color);
    }

    .tab-content {
      display: none;
      background-color: var(--card-color);
      border-radius: var(--border-radius);
      padding: 15px;
      box-shadow: var(--box-shadow);
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .tab-content.active {
      display: block;
    }

    /* Dashboard */
    .dashboard {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .stats-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .stat-card {
      flex: 1;
      min-width: 180px;
      background-color: var(--card-color);
      border-radius: var(--border-radius);
      padding: 15px;
      text-align: center;
      box-shadow: var(--box-shadow);
      border-top: 3px solid;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }

    .stat-card.total {
      border-top-color: var(--accent-color);
    }

    .stat-card.active {
      border-top-color: var(--success-color);
    }

    .stat-card.inactive {
      border-top-color: var(--warning-color);
    }

    .stat-card.operators {
      border-top-color: var(--operator-color);
    }

    .stat-card.drivers {
      border-top-color: var(--driver-color);
    }

    .stat-title {
      color: var(--subtle-text);
      font-size: 15px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: bold;
      margin: 8px 0;
    }

    .charts-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .chart-container {
      flex: 1;
      min-width: 280px;
      background-color: var(--card-color);
      border-radius: var(--border-radius);
      padding: 15px;
      box-shadow: var(--box-shadow);
    }

    .chart-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chart-title i {
      color: var(--accent-color);
    }

    .chart {
      height: 260px;
      position: relative;
    }

    /* Inactive Trucks Section */
    .inactive-section {
      background-color: var(--inactive-bg);
      border: 1px solid var(--inactive-border);
      border-radius: var(--border-radius);
      padding: 15px;
      margin-top: 20px;
      box-shadow: var(--box-shadow);
    }

    .inactive-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--inactive-border);
    }

    .inactive-header h2 {
      font-size: 18px;
      color: var(--text-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .inactive-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .inactive-truck {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
    }

    .inactive-truck:last-child {
      border-bottom: none;
    }

    .truck-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .truck-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #3498db;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .truck-details {
      display: flex;
      flex-direction: column;
    }

    .truck-plate {
      font-weight: 600;
      color: var(--text-color);
    }

    .truck-operator {
      font-size: 13px;
      color: var(--subtle-text);
    }

    .reactivate-btn {
      background-color: var(--success-color);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
      transition: var(--transition);
    }

    .reactivate-btn:hover {
      background-color: #219653;
    }

    /* Truck List */
    .truck-list-container {
      background-color: var(--card-color);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--box-shadow);
      overflow-x: auto;
      max-height: 60vh;
      position: relative;
    }

    .truck-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1000px;
    }

    .truck-table th {
      background: linear-gradient(to bottom, var(--header-color), #1a2530);
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      position: sticky;
      top: 0;
      font-size: 14px;
    }

    .truck-table td {
      padding: 10px 12px;
      border-bottom: 1px solid #eee;
      font-size: 14px;
    }

    .truck-table tbody tr:nth-child(even) {
      background-color: var(--row-color1);
    }

    .truck-table tbody tr:nth-child(odd) {
      background-color: var(--row-color2);
    }

    .truck-table tbody tr:hover {
      background-color: #e3f2fd;
      cursor: pointer;
    }

    .truck-table tbody tr.selected {
      background-color: #d1ecf1;
      box-shadow: inset 0 0 0 2px var(--accent-color);
    }

    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 500;
      text-align: center;
      min-width: 70px;
      font-size: 13px;
    }

    .status-active {
      background-color: var(--success-color);
      color: white;
      box-shadow: 0 1px 3px rgba(39, 174, 96, 0.3);
    }

    .status-inactive {
      background-color: var(--warning-color);
      color: white;
      box-shadow: 0 1px 3px rgba(231, 76, 60, 0.3);
    }

    .toggle-btn {
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
      border: none;
      color: white;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
    }

    .toggle-btn i {
      font-size: 12px;
    }

    .toggle-active {
      background-color: var(--warning-color);
    }

    .toggle-inactive {
      background-color: var(--success-color);
    }

    .delete-btn {
      background-color: #e74c3c;
      color: white;
      padding: 5px 8px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background-color 0.2s;
      font-size: 13px;
    }

    .delete-btn:hover {
      background-color: #c0392b;
    }

    /* Activity Log */
    .log-container {
      background-color: var(--card-color);
      border-radius: var(--border-radius);
      padding: 15px;
      box-shadow: var(--box-shadow);
      display: flex;
      flex-direction: column;
      height: 450px;
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .log-title {
      font-size: 16px;
      font-weight: 600;
    }

    .log-content {
      flex: 1;
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      padding: 12px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 13px;
      background: linear-gradient(to bottom, #f9f9f9, #f0f0f0);
    }

    .log-entry {
      margin-bottom: 6px;
      padding-bottom: 6px;
      border-bottom: 1px solid #eee;
      display: flex;
    }

    .log-timestamp {
      color: var(--subtle-text);
      font-weight: 500;
      margin-right: 8px;
      min-width: 110px;
      font-size: 12px;
    }

    /* Status Bar */
    .status-bar {
      background: linear-gradient(to right, var(--status-bar-color), #cbd2d9);
      padding: 8px 20px;
      font-size: 13px;
      font-weight: 500;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
      display: flex;
      justify-content: space-between;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
      width: 90%;
      max-width: 750px;
      overflow: hidden;
      animation: modalAppear 0.3s ease;
    }

    @keyframes modalAppear {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-header {
      background: linear-gradient(to right, var(--header-color), #1a2530);
      color: white;
      padding: 12px 18px;
      font-size: 17px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 22px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .modal-close:hover {
      transform: scale(1.1);
    }

    .modal-body {
      padding: 18px;
      max-height: 65vh;
      overflow-y: auto;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--text-color);
      font-size: 14px;
    }

    .form-control {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      transition: var(--transition);
    }

    .form-control:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
      outline: none;
    }

    .radio-group {
      display: flex;
      gap: 15px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }

    .form-row {
      display: flex;
      gap: 12px;
    }

    .form-row .form-group {
      flex: 1;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      padding: 12px 18px;
      background-color: #f8f9fa;
      gap: 8px;
    }

    /* Excel Data Viewer */
    .excel-viewer {
      background-color: var(--card-color);
      border-radius: var(--border-radius);
      padding: 15px;
      box-shadow: var(--box-shadow);
      overflow-x: auto;
      max-height: 65vh;
      position: relative;
    }

    .excel-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1200px;
    }

    .excel-table th {
      background: linear-gradient(to bottom, var(--header-color), #1a2530);
      color: white;
      padding: 10px 12px;
      text-align: left;
      font-weight: 600;
      position: sticky;
      top: 0;
      font-size: 13px;
    }

    .excel-table td {
      padding: 8px 10px;
      border-bottom: 1px solid #eee;
      font-size: 13px;
    }

    .excel-table tbody tr:nth-child(even) {
      background-color: var(--row-color1);
    }

    .excel-table tbody tr:nth-child(odd) {
      background-color: var(--row-color2);
    }

    .excel-table tbody tr:hover {
      background-color: #e3f2fd;
    }

    .highlight-cell {
      background-color: #fff3cd !important;
    }

    .pending-cell {
      background-color: #d1ecf1 !important;
    }

    /* Status badges */
    .status-badge-pending {
      background-color: var(--pending-color);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
    }

    .status-badge-sent {
      background-color: var(--sent-color);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
    }

    .status-badge-paid {
      background-color: var(--paid-color);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
    }

    .status-badge-overdue {
      background-color: var(--overdue-color);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
    }

    /* Editable cells */
    .editable-cell {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 3px;
      padding: 3px 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 13px;
      width: 100%;
    }

    .editable-cell:hover {
      background-color: #f0f8ff;
      border-color: #3498db;
    }

    .editable-cell:focus {
      outline: none;
      background-color: #fff;
      border-color: #3498db;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    .save-btn {
      padding: 5px 10px;
      background-color: #27ae60;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 11px;
      transition: background-color 0.2s;
    }

    .save-btn:hover {
      background-color: #219653;
    }

    .add-trip-btn {
      background-color: var(--accent-color);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 12px;
      transition: var(--transition);
      font-size: 14px;
    }

    .add-trip-btn:hover {
      background-color: var(--button-hover);
      transform: translateY(-2px);
    }

    /* Vehicle type badges */
    .wcv6-badge {
      background-color: var(--wcv6-color);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
      display: inline-block;
    }

    .wcv4-badge {
      background-color: var(--wcv4-color);
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 11px;
      display: inline-block;
    }

    .rate-cell {
      background-color: #e8f5e9;
      font-weight: 600;
      color: #2e7d32;
      text-align: right;
      padding: 4px 8px;
      border-radius: 3px;
      font-size: 13px;
    }

    /* Rate info */
    .rate-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px;
      background: linear-gradient(to right, #e3f2fd, #bbdefb);
      border-radius: var(--border-radius);
      margin-top: 5px;
      font-weight: 500;
      font-size: 14px;
    }

    .rate-info .rate-value {
      color: var(--accent-color);
      font-weight: bold;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 30px 15px;
      color: var(--subtle-text);
    }

    .empty-state i {
      font-size: 40px;
      margin-bottom: 12px;
      color: #d1d8e0;
    }

    .empty-state h3 {
      font-size: 20px;
      margin-bottom: 8px;
      color: var(--text-color);
    }

    .empty-state p {
      margin-bottom: 15px;
      max-width: 450px;
      margin-left: auto;
      margin-right: auto;
      font-size: 14px;
    }

    /* SOA Table Styles */
    .soa-container {
      background-color: var(--card-color);
      border-radius: var(--border-radius);
      padding: 15px;
      box-shadow: var(--box-shadow);
    }

    .soa-header {
      text-align: center;
      margin-bottom: 15px;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--accent-color);
    }

    .soa-header h2 {
      color: var(--header-color);
      font-size: 22px;
    }

    .soa-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    .soa-table th {
      background-color: var(--soa-header);
      color: white;
      padding: 10px 12px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
    }

    .soa-table td {
      padding: 10px 12px;
      border-bottom: 1px solid #eee;
      font-size: 14px;
    }

    .soa-table tr:nth-child(even) {
      background-color: var(--row-color1);
    }

    .soa-table tr:nth-child(odd) {
      background-color: var(--row-color2);
    }

    .soa-table tr:last-child {
      font-weight: bold;
      background-color: #e3f2fd;
      border-top: 2px solid var(--accent-color);
    }

    .soa-input {
      width: 100%;
      padding: 7px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: white;
      text-align: right;
      font-size: 14px;
    }

    .soa-input:focus {
      border-color: var(--accent-color);
      outline: none;
    }

    .soa-total {
      font-weight: bold;
      color: var(--text-color);
    }

    .soa-label {
      font-weight: 500;
    }

    .soa-subrow {
      padding-left: 25px;
    }

    .soa-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 15px;
    }

    .soa-generate-btn {
      background-color: var(--success-color);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: var(--transition);
      font-size: 14px;
    }

    .soa-generate-btn:hover {
      background-color: #219653;
      transform: translateY(-2px);
    }

    .soa-download-btn {
      background-color: #9b59b6;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: var(--transition);
      font-size: 14px;
    }

    .soa-download-btn:hover {
      background-color: #8e44ad;
      transform: translateY(-2px);
    }

    /* SOA Date Range */
    .soa-date-range {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .soa-date-group {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 160px;
    }

    .soa-date-group label {
      font-weight: 500;
      margin-bottom: 4px;
      font-size: 14px;
    }

    .soa-operator-row {
      margin-bottom: 15px;
    }

    /* Hide rate rows */
    .rate-row {
      display: none;
    }

    /* Highlight cash advance */
    .cash-advance-row td {
      background-color: #fde8e8;
    }

    .soa-total-row {
      font-weight: bold;
      background-color: #e3f2fd;
      border-top: 2px solid var(--accent-color);
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 15px;
      align-items: center;
    }

    .pagination-btn {
      padding: 6px 12px;
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .pagination-btn:disabled {
      background-color: #bdc3c7;
      cursor: not-allowed;
    }

    .pagination-info {
      font-size: 14px;
      color: var(--text-color);
    }

    /* Loading spinner */
    .loading-spinner {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Login Modal */
    .login-container {
      background: white;
      border-radius: var(--border-radius);
      padding: 30px;
      box-shadow: var(--box-shadow);
      width: 90%;
      max-width: 400px;
      text-align: center;
    }

    .login-header {
      margin-bottom: 20px;
    }

    .login-header h2 {
      font-size: 24px;
      color: var(--header-color);
      margin-bottom: 10px;
    }

    .login-logo {
      font-size: 40px;
      color: var(--accent-color);
      margin-bottom: 15px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .stats-row, .charts-row {
        flex-direction: column;
      }

      .tabs {
        flex-wrap: wrap;
      }

      .tab {
        flex: 1;
        text-align: center;
        justify-content: center;
        min-width: 90px;
        font-size: 13px;
        padding: 8px 12px;
      }

      .form-row {
        flex-direction: column;
        gap: 0;
      }

      .modal-content {
        width: 95%;
      }

      .soa-date-range {
        flex-direction: column;
        gap: 8px;
      }

      .soa-actions {
        flex-direction: column;
      }

      .logo {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
<!-- Login Modal -->
<div class="modal" id="loginModal" style="display: flex;">
  <div class="login-container">
    <div class="login-header">
      <div class="login-logo">
        <i class="fas fa-truck-moving"></i>
      </div>
      <h2>TDRS Login</h2>
      <p>Access your truck management system</p>
    </div>
    <div class="form-group">
      <input type="email" id="loginEmail" class="form-control" placeholder="Email">
    </div>
    <div class="form-group">
      <input type="password" id="loginPassword" class="form-control" placeholder="Password">
    </div>
    <button class="btn btn-primary" id="loginBtn" style="width: 100%;">
      <i class="fas fa-sign-in-alt"></i> Login
    </button>
    <div class="form-group" style="margin-top: 15px;">
      <p style="font-size: 13px; color: var(--subtle-text);">
        Demo credentials: admin@tdrs.com / password123
      </p>
    </div>
  </div>
</div>

<!-- Main App (hidden until logged in) -->
<div id="appContainer" style="display: none;">
  <!-- Header -->
  <header>
    <div class="logo">
      <i class="fas fa-truck-moving"></i>
      <span>TDRS - Truck Dispatch & Revenue System</span>
    </div>
    <div class="header-right">
      <div class="datetime" id="datetime"></div>
      <div class="status-indicator">
        <div class="indicator-dot"></div>
        <span>Operational</span>
      </div>
      <div class="user-info">
        <div class="user-avatar" id="userAvatar">A</div>
        <button class="logout-btn" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Control Panel -->
  <div class="control-panel">
    <button class="btn btn-operator" id="addTruckBtn">
      <i class="fas fa-plus"></i> Add Truck
    </button>
    <button class="btn btn-danger" id="exportDataBtn">
      <i class="fas fa-download"></i> Export Data
    </button>
    <button class="btn btn-primary" id="refreshBtn">
      <i class="fas fa-sync-alt"></i> Refresh
    </button>
    <button class="btn btn-success" id="backupBtn">
      <i class="fas fa-save"></i> Backup
    </button>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" data-tab="dashboard">
        <i class="fas fa-chart-bar"></i> Dashboard
      </div>
      <div class="tab" data-tab="trucks">
        <i class="fas fa-truck"></i> Truck List
      </div>
      <div class="tab" data-tab="excel">
        <i class="fas fa-file-excel"></i> Trip Data
      </div>
      <div class="tab" data-tab="soa">
        <i class="fas fa-file-invoice-dollar"></i> SOA
      </div>
      <div class="tab" data-tab="log">
        <i class="fas fa-clipboard-list"></i> Activity Log
      </div>
    </div>

    <!-- Dashboard Tab -->
    <div class="tab-content active" id="dashboard-tab">
      <div class="dashboard">
        <div class="stats-row">
          <div class="stat-card total">
            <div class="stat-title">Total Trucks</div>
            <div class="stat-value" id="totalTrucks">12</div>
            <div><i class="fas fa-truck fa-2x" style="color: var(--accent-color);"></i></div>
          </div>
          <div class="stat-card active">
            <div class="stat-title">Active Trucks</div>
            <div class="stat-value" id="activeTrucks">10</div>
            <div><i class="fas fa-check-circle fa-2x" style="color: var(--success-color);"></i></div>
          </div>
          <div class="stat-card inactive">
            <div class="stat-title">Inactive Trucks</div>
            <div class="stat-value" id="inactiveTrucks">2</div>
            <div><i class="fas fa-ban fa-2x" style="color: var(--warning-color);"></i></div>
          </div>
          <div class="stat-card operators">
            <div class="stat-title">Operators</div>
            <div class="stat-value" id="totalOperators">5</div>
            <div><i class="fas fa-user-tie fa-2x" style="color: var(--operator-color);"></i></div>
          </div>
          <div class="stat-card drivers">
            <div class="stat-title">Drivers</div>
            <div class="stat-value" id="totalDrivers">10</div>
            <div><i class="fas fa-id-card fa-2x" style="color: var(--driver-color);"></i></div>
          </div>
        </div>

        <div class="charts-row">
          <div class="chart-container">
            <div class="chart-title">
              <i class="fas fa-chart-pie"></i> Vehicle Type Distribution
            </div>
            <div class="chart">
              <canvas id="vehicleTypeChart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <div class="chart-title">
              <i class="fas fa-chart-bar"></i> Trip Cost Analysis
            </div>
            <div class="chart">
              <canvas id="costChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Inactive Trucks Section -->
        <div class="inactive-section">
          <div class="inactive-header">
            <h2><i class="fas fa-truck-loading"></i> Inactive Trucks</h2>
            <span id="inactiveCount">2 Trucks</span>
          </div>
          <div class="inactive-list" id="inactiveTrucksList">
            <div class="inactive-truck">
              <div class="truck-info">
                <div class="truck-avatar">JD</div>
                <div class="truck-details">
                  <div class="truck-plate">ABC123</div>
                  <div class="truck-operator">John Doe Transport</div>
                </div>
              </div>
              <button class="reactivate-btn">
                <i class="fas fa-toggle-on"></i> Reactivate
              </button>
            </div>
            <div class="inactive-truck">
              <div class="truck-info">
                <div class="truck-avatar">SJ</div>
                <div class="truck-details">
                  <div class="truck-plate">XYZ789</div>
                  <div class="truck-operator">Smith & Jones Logistics</div>
                </div>
              </div>
              <button class="reactivate-btn">
                <i class="fas fa-toggle-on"></i> Reactivate
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Truck List Tab -->
    <div class="tab-content" id="trucks-tab">
      <div class="truck-list-container">
        <table class="truck-table">
          <thead>
          <tr>
            <th>ID</th>
            <th>License Plate</th>
            <th>Operator</th>
            <th>Driver</th>
            <th>Vehicle Type</th>
            <th>Bank Account</th>
            <th>Contact No.</th>
            <th>Rate</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody id="truckListBody">
          <tr>
            <td>101</td>
            <td>ABC123</td>
            <td>
              <div class="operator-info">
                <div class="operator-avatar">JD</div><span>John Doe Transport</span>
              </div>
            </td>
            <td>
              <div class="driver-info">
                <div class="driver-avatar">MD</div><span>Michael Driver</span>
              </div>
            </td>
            <td>
              <span class="wcv6-badge">6 WCV</span>
            </td>
            <td>**** **** 1234</td>
            <td>+1 555-1234</td>
            <td class="rate-cell">₱3,166.67</td>
            <td>
              <span class="status-badge status-inactive">Inactive</span>
            </td>
            <td>
              <button class="toggle-btn toggle-inactive">
                <i class="fas fa-toggle-on"></i>
                Set Active
              </button>
              <button class="delete-btn">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          <tr>
            <td>102</td>
            <td>XYZ789</td>
            <td>
              <div class="operator-info">
                <div class="operator-avatar">SJ</div><span>Smith & Jones Logistics</span>
              </div>
            </td>
            <td>
              <div class="driver-info">
                <div class="driver-avatar">RS</div><span>Robert Smith</span>
              </div>
            </td>
            <td>
              <span class="wcv4-badge">4 WCV</span>
            </td>
            <td>**** **** 5678</td>
            <td>+1 555-5678</td>
            <td class="rate-cell">₱2,833.33</td>
            <td>
              <span class="status-badge status-active">Active</span>
            </td>
            <td>
              <button class="toggle-btn toggle-active">
                <i class="fas fa-toggle-off"></i>
                Set Inactive
              </button>
              <button class="delete-btn">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Excel Data Tab -->
    <div class="tab-content" id="excel-tab">
      <div class="excel-viewer">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h2 style="color: var(--header-color); display: flex; align-items: center; gap: 8px; font-size: 18px;">
            <i class="fas fa-file-excel" style="color: #217346;"></i>
            TDRS Trip Management
          </h2>
          <button class="add-trip-btn" id="addTripBtn">
            <i class="fas fa-plus"></i> Add New Trip
          </button>
        </div>
        <table class="excel-table" id="excelDataTable">
          <thead>
          <tr>
            <th>SPX ID</th>
            <th>Trip Date</th>
            <th>Pickup</th>
            <th>Destination Hub</th>
            <th>Operator</th>
            <th>Driver</th>
            <th>Plate Number</th>
            <th>Vehicle Type</th>
            <th>Rate</th>
            <th>Fuel</th>
            <th>Parking</th>
            <th>Tolls</th>
            <th>2nd Trip Costs</th>
            <th>Total Amount</th>
            <th>Documents</th>
            <th>2nd Trip</th>
            <th>Delete</th>
          </tr>
          </thead>
          <tbody id="excelDataBody">
          <tr>
            <td>SPX1001</td>
            <td><input type="date" class="editable-cell" value="2023-06-15"></td>
            <td><input type="text" class="editable-cell" value="Manila Warehouse"></td>
            <td><input type="text" class="editable-cell" value="Cebu Hub"></td>
            <td>John Doe Transport</td>
            <td>Michael Driver</td>
            <td class="highlight-cell">ABC123</td>
            <td>
              <span class="wcv6-badge">6 WCV</span>
            </td>
            <td class="rate-cell">₱3,166.67</td>
            <td><input type="number" step="0.01" class="editable-cell" value="1200.00"></td>
            <td><input type="number" step="0.01" class="editable-cell" value="350.00"></td>
            <td><input type="number" step="0.01" class="editable-cell" value="450.00"></td>
            <td class="rate-cell">₱0.00</td>
            <td class="rate-cell">₱5,166.67</td>
            <td>
              <select class="editable-select">
                <option value="Pending" selected>Pending</option>
                <option value="Sent">Sent</option>
                <option value="Paid">Paid</option>
                <option value="Overdue">Overdue</option>
              </select>
            </td>
            <td>
              <select class="editable-select">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
              </select>
            </td>
            <td>
              <button class="delete-btn">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          <tr>
            <td>SPX1002</td>
            <td><input type="date" class="editable-cell" value="2023-06-16"></td>
            <td><input type="text" class="editable-cell" value="Cavite Depot"></td>
            <td><input type="text" class="editable-cell" value="Batangas Port"></td>
            <td>Smith & Jones Logistics</td>
            <td>Robert Smith</td>
            <td class="highlight-cell">XYZ789</td>
            <td>
              <span class="wcv4-badge">4 WCV</span>
            </td>
            <td class="rate-cell">₱2,833.33</td>
            <td><input type="number" step="0.01" class="editable-cell" value="950.00"></td>
            <td><input type="number" step="0.01" class="editable-cell" value="250.00"></td>
            <td><input type="number" step="0.01" class="editable-cell" value="300.00"></td>
            <td class="rate-cell">₱0.00</td>
            <td class="rate-cell">₱4,333.33</td>
            <td>
              <select class="editable-select">
                <option value="Pending">Pending</option>
                <option value="Sent" selected>Sent</option>
                <option value="Paid">Paid</option>
                <option value="Overdue">Overdue</option>
              </select>
            </td>
            <td>
              <select class="editable-select">
                <option value="true" selected>Yes</option>
                <option value="false">No</option>
              </select>
            </td>
            <td>
              <button class="delete-btn">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          </tbody>
        </table>
        <div class="pagination">
          <button class="pagination-btn" id="prevPageBtn" disabled>
            <i class="fas fa-chevron-left"></i>
          </button>
          <span class="pagination-info" id="pageInfo">Page 1 of 1</span>
          <button class="pagination-btn" id="nextPageBtn" disabled>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- SOA Tab -->
    <div class="tab-content" id="soa-tab">
      <div class="soa-container">
        <div class="soa-header">
          <h2><i class="fas fa-file-invoice-dollar"></i> Statement of Account (SOA)</h2>
        </div>

        <div class="soa-date-range">
          <div class="soa-date-group">
            <label for="soaDateFrom">Date From:</label>
            <input type="date" id="soaDateFrom" value="2023-06-01">
          </div>
          <div class="soa-date-group">
            <label for="soaDateTo">Date To:</label>
            <input type="date" id="soaDateTo" value="2023-06-16">
          </div>
        </div>

        <div class="soa-operator-row">
          <select id="soaOperator" class="soa-operator-select">
            <option value="">Select Operator</option>
            <option value="John Doe Transport" selected>John Doe Transport</option>
            <option value="Smith & Jones Logistics">Smith & Jones Logistics</option>
          </select>
        </div>

        <table class="soa-table">
          <tbody>
          <tr>
            <td class="soa-label">Trips per Vehicle Type:</td>
            <td></td>
          </tr>
          <tr class="soa-subrow">
            <td>4 WCV</td>
            <td>
              <input type="number" class="soa-input" id="trips4" value="0" min="0" readonly>
            </td>
          </tr>
          <tr class="soa-subrow">
            <td>6 WCV</td>
            <td>
              <input type="number" class="soa-input" id="trips6" value="1" min="0" readonly>
            </td>
          </tr>

          <tr>
            <td class="soa-label">No. Of second trip</td>
            <td></td>
          </tr>
          <tr class="soa-subrow">
            <td>4 WCV</td>
            <td>
              <input type="number" class="soa-input" id="secondTrips4" value="0" min="0" readonly>
            </td>
          </tr>
          <tr class="soa-subrow">
            <td>6 WCV</td>
            <td>
              <input type="number" class="soa-input" id="secondTrips6" value="0" min="0" readonly>
            </td>
          </tr>

          <tr>
            <td class="soa-label">Total Trip</td>
            <td>
              <input type="text" class="soa-input soa-total" id="totalTrips" value="1" readonly>
            </td>
          </tr>

          <tr>
            <td class="soa-label">Toll:</td>
            <td>
              <input type="text" class="soa-input soa-total" id="toll" value="₱450.00" readonly>
            </td>
          </tr>

          <tr>
            <td class="soa-label">Parking:</td>
            <td>
              <input type="text" class="soa-input soa-total" id="parking" value="₱350.00" readonly>
            </td>
          </tr>

          <tr>
            <td class="soa-label">Gas:</td>
            <td>
              <input type="text" class="soa-input soa-total" id="gas" value="₱1,200.00" readonly>
            </td>
          </tr>

          <!-- Fixed: Added Total Expenses row -->
          <tr>
            <td class="soa-label">Total Expenses:</td>
            <td>
              <input type="text" class="soa-input soa-total" id="totalExpenses" value="₱2,000.00" readonly>
            </td>
          </tr>

          <tr class="cash-advance-row">
            <td class="soa-label">Cash Advance:</td>
            <td>
              <input type="number" class="soa-input" id="cashAdvance" value="500.00" step="0.01" min="0" placeholder="Enter amount (will be deducted)">
            </td>
          </tr>

          <tr>
            <td class="soa-label">Total Trip:</td>
            <td></td>
          </tr>
          <tr class="soa-subrow">
            <td>4 WCV</td>
            <td>
              <input type="text" class="soa-input soa-total" id="total4" value="₱0.00" readonly>
            </td>
          </tr>
          <tr class="soa-subrow">
            <td>6 WCV</td>
            <td>
              <input type="text" class="soa-input soa-total" id="total6" value="₱3,166.67" readonly>
            </td>
          </tr>

          <tr class="soa-total-row">
            <td class="soa-label">Total Payable:</td>
            <td>
              <input type="text" class="soa-input soa-total" id="totalPayable" value="₱2,666.67" readonly>
            </td>
          </tr>
          </tbody>
        </table>

        <div class="soa-actions">
          <button class="soa-generate-btn" id="generateSOA">
            <i class="fas fa-calculator"></i> Generate SOA
          </button>
          <button class="soa-download-btn" id="downloadSOA">
            <i class="fas fa-file-pdf"></i> Download PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Activity Log Tab -->
    <div class="tab-content" id="log-tab">
      <div class="log-container">
        <div class="log-header">
          <div class="log-title">System Activity Log</div>
          <button class="btn btn-secondary" id="clearLogBtn">
            <i class="fas fa-trash"></i> Clear Log
          </button>
        </div>
        <div class="log-content" id="logContent">
          <div class="log-entry">
            <span class="log-timestamp">[06/16/2023, 09:45 AM]</span>
            <span>System initialized - Ready to track trucks</span>
          </div>
          <div class="log-entry">
            <span class="log-timestamp">[06/16/2023, 10:15 AM]</span>
            <span>Truck ABC123 added to system</span>
          </div>
          <div class="log-entry">
            <span class="log-timestamp">[06/16/2023, 11:30 AM]</span>
            <span>Trip SPX1001 recorded successfully</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Status Bar -->
  <div class="status-bar">
    <span id="statusText">Total Trucks: 12 | Active: 10 | Operators: 5 | Drivers: 10</span>
    <span>System Status: <span style="color: var(--success-color);">Operational</span></span>
  </div>

  <!-- Add Truck Modal -->
  <div class="modal" id="addTruckModal">
    <div class="modal-content">
      <div class="modal-header">Add New Truck</div>
      <div class="modal-body">
        <div class="form-group">
          <label for="licensePlate">License Plate</label>
          <input type="text" id="licensePlate" class="form-control" placeholder="Enter license plate">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="operatorName">Operator Name</label>
            <input type="text" id="operatorName" class="form-control" placeholder="Enter operator name">
          </div>
          <div class="form-group">
            <label for="driverName">Driver Name</label>
            <input type="text" id="driverName" class="form-control" placeholder="Enter driver name">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="bankAccount">Bank Account</label>
            <input type="text" id="bankAccount" class="form-control" placeholder="Enter bank account number">
          </div>
          <div class="form-group">
            <label for="phoneNumber">Contact Number</label>
            <input type="text" id="phoneNumber" class="form-control" placeholder="Enter contact number">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="vehicleType">Vehicle Type</label>
            <select id="vehicleType" class="form-control">
              <option value="6 WCV">6 WCV</option>
              <option value="4 WCV">4 WCV</option>
            </select>
          </div>
          <div class="form-group">
            <label for="truckRate">Rate (₱)</label>
            <input type="number" id="truckRate" class="form-control" placeholder="Rate will be calculated" readonly>
          </div>
        </div>

        <div class="rate-info">
          <div>6 WCV: <span class="rate-value">₱3,166.67</span></div>
          <div>4 WCV: <span class="rate-value">₱2,833.33</span></div>
        </div>

        <div class="form-group">
          <label>Status</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="statusActive" name="truckStatus" value="Active" checked>
              <label for="statusActive">Active</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="statusInactive" name="truckStatus" value="Inactive">
              <label for="statusInactive">Inactive</label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelAddBtn">Cancel</button>
        <button class="btn btn-success" id="submitAddBtn">Add Truck</button>
      </div>
    </div>
  </div>

  <!-- Add Trip Modal -->
  <div class="modal" id="addTripModal">
    <div class="modal-content">
      <div class="modal-header">Add New Trip</div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label for="tripDate">Trip Date</label>
            <input type="date" id="tripDate" class="form-control" value="2023-06-16">
          </div>
          <div class="form-group">
            <label for="spxId">SPX ID</label>
            <input type="text" id="spxId" class="form-control" placeholder="Enter SPX ID">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="pickupLocation">Pickup Location</label>
            <input type="text" id="pickupLocation" class="form-control" placeholder="Enter pickup location">
          </div>
          <div class="form-group">
            <label for="destinationHub">Destination Hub</label>
            <input type="text" id="destinationHub" class="form-control" placeholder="Enter destination hub">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="tripOperator">Operator</label>
            <select id="tripOperator" class="form-control">
              <option value="">Select Operator</option>
              <option value="John Doe Transport">John Doe Transport</option>
              <option value="Smith & Jones Logistics">Smith & Jones Logistics</option>
            </select>
          </div>
          <div class="form-group">
            <label for="tripDriver">Driver</label>
            <select id="tripDriver" class="form-control">
              <option value="">Select Driver</option>
              <option value="Michael Driver">Michael Driver</option>
              <option value="Robert Smith">Robert Smith</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="tripPlate">License Plate</label>
            <input type="text" id="tripPlate" class="form-control" value="ABC123">
          </div>
          <div class="form-group">
            <label for="tripVehicleType">Vehicle Type</label>
            <input type="text" id="tripVehicleType" class="form-control" value="6 WCV">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="fuelCost">Fuel Cost (₱)</label>
            <input type="number" step="0.01" id="fuelCost" class="form-control" placeholder="0.00" value="0">
          </div>
          <div class="form-group">
            <label for="parkingCost">Parking Cost (₱)</label>
            <input type="number" step="0.01" id="parkingCost" class="form-control" placeholder="0.00" value="0">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="tollsCost">Tolls Cost (₱)</label>
            <input type="number" step="0.01" id="tollsCost" class="form-control" placeholder="0.00" value="0">
          </div>
          <div class="form-group">
            <label for="documentStatus">Document Status</label>
            <select id="documentStatus" class="form-control">
              <option value="Pending">Pending</option>
              <option value="Sent">Sent</option>
              <option value="Paid">Paid</option>
              <option value="Overdue">Overdue</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="secondTrip">Second Trip</label>
            <select id="secondTrip" class="form-control">
              <option value="true">Yes</option>
              <option value="false" selected>No</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelTripBtn">Cancel</button>
        <button class="btn btn-success" id="submitTripBtn">Add Trip</button>
      </div>
    </div>
  </div>
</div>

<script>
  // Firebase configuration (replace with your own)
  const firebaseConfig = {
    apiKey: "AIzaSyBv9aQ1t9XfR9t4FkL0y7pJj5lKz1m2n3o",
    authDomain: "tdrs-system.firebaseapp.com",
    databaseURL: "https://tdrs-system-default-rtdb.firebaseio.com",
    projectId: "tdrs-system",
    storageBucket: "tdrs-system.appspot.com",
    messagingSenderId: "123456789012",
    appId: "1:123456789012:web:abcdef1234567890"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
  const auth = firebase.auth();

  // Application state
  const state = {
    trucks: [],
    trips: [],
    activityLog: [],
    vehicleTypeChart: null,
    costChart: null,
    tripPage: {
      currentPage: 1,
      pageSize: 20,
      totalPages: 1
    },
    currentUser: null
  };

  // DOM Elements
  const elements = {
    loginModal: document.getElementById('loginModal'),
    appContainer: document.getElementById('appContainer'),
    loginBtn: document.getElementById('loginBtn'),
    logoutBtn: document.getElementById('logoutBtn'),
    loginEmail: document.getElementById('loginEmail'),
    loginPassword: document.getElementById('loginPassword'),
    datetime: document.getElementById('datetime'),
    totalTrucks: document.getElementById('totalTrucks'),
    activeTrucks: document.getElementById('activeTrucks'),
    inactiveTrucks: document.getElementById('inactiveTrucks'),
    totalOperators: document.getElementById('totalOperators'),
    totalDrivers: document.getElementById('totalDrivers'),
    statusText: document.getElementById('statusText'),
    truckListBody: document.getElementById('truckListBody'),
    logContent: document.getElementById('logContent'),
    vehicleTypeChart: document.getElementById('vehicleTypeChart'),
    costChart: document.getElementById('costChart'),
    addTruckModal: document.getElementById('addTruckModal'),
    addTripModal: document.getElementById('addTripModal'),
    licensePlate: document.getElementById('licensePlate'),
    operatorName: document.getElementById('operatorName'),
    driverName: document.getElementById('driverName'),
    bankAccount: document.getElementById('bankAccount'),
    phoneNumber: document.getElementById('phoneNumber'),
    tabs: document.querySelectorAll('.tab'),
    tabContents: document.querySelectorAll('.tab-content'),
    excelDataBody: document.getElementById('excelDataBody'),
    addTripBtn: document.getElementById('addTripBtn'),
    tripOperator: document.getElementById('tripOperator'),
    tripDriver: document.getElementById('tripDriver'),
    tripPlate: document.getElementById('tripPlate'),
    tripVehicleType: document.getElementById('tripVehicleType'),
    truckRate: document.getElementById('truckRate'),
    vehicleTypeSelect: document.getElementById('vehicleType'),
    userAvatar: document.getElementById('userAvatar'),
    generateSOA: document.getElementById('generateSOA'),
    downloadSOA: document.getElementById('downloadSOA'),
    inactiveCount: document.getElementById('inactiveCount'),
    inactiveTrucksList: document.getElementById('inactiveTrucksList'),
    totalExpenses: document.getElementById('totalExpenses')
  };

  // Initialize the application
  function init() {
    setupEventListeners();
    updateDateTime();
    setInterval(updateDateTime, 1000);
    renderCharts();
    setupFirebaseListeners();
  }

  // Setup Firebase real-time listeners
  function setupFirebaseListeners() {
    const userId = state.currentUser.uid;

    // Listen for trucks data
    database.ref(`users/${userId}/trucks`).on('value', (snapshot) => {
      state.trucks = snapshot.val() || [];
      renderTruckList();
      updateStatistics();
      renderInactiveTrucks();
    });

    // Listen for trips data
    database.ref(`users/${userId}/trips`).on('value', (snapshot) => {
      state.trips = snapshot.val() || [];
      if (document.getElementById('excel-tab').classList.contains('active')) {
        renderExcelTable();
      }
      updateCharts();
    });

    // Listen for activity log
    database.ref(`users/${userId}/activityLog`).on('value', (snapshot) => {
      state.activityLog = snapshot.val() || [];
      renderActivityLog();
    });
  }

  // Save data to Firebase
  function saveToFirebase(dataType, data) {
    const userId = state.currentUser.uid;
    database.ref(`users/${userId}/${dataType}`).set(data);
  }

  // Render activity log
  function renderActivityLog() {
    elements.logContent.innerHTML = '';
    state.activityLog.forEach(entry => {
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';
      logEntry.innerHTML = `<span class="log-timestamp">[${entry.timestamp}]</span><span>${entry.message}</span>`;
      elements.logContent.appendChild(logEntry);
    });
    elements.logContent.scrollTop = elements.logContent.scrollHeight;
  }

  // Log activity and save to Firebase
  function logActivity(message) {
    const now = new Date();
    const timestamp = now.toLocaleString('en-US', {
      year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'
    });

    // Add to state
    state.activityLog.push({timestamp, message});

    // Save to Firebase
    saveToFirebase('activityLog', state.activityLog);

    // Update UI
    renderActivityLog();
  }

  // Setup event listeners
  function setupEventListeners() {
    // Login button
    elements.loginBtn.addEventListener('click', () => {
      const email = elements.loginEmail.value;
      const password = elements.loginPassword.value;

      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          state.currentUser = userCredential.user;
          elements.loginModal.style.display = 'none';
          elements.appContainer.style.display = 'block';

          // Set user avatar
          const initials = email.charAt(0).toUpperCase();
          elements.userAvatar.textContent = initials;

          // Initialize Firebase listeners
          setupFirebaseListeners();

          // Log system initialization
          logActivity('User logged in');
        })
        .catch((error) => {
          alert('Login failed: ' + error.message);
        });
    });

    // Logout button
    elements.logoutBtn.addEventListener('click', () => {
      auth.signOut().then(() => {
        state.currentUser = null;
        elements.appContainer.style.display = 'none';
        elements.loginModal.style.display = 'flex';
        logActivity('User logged out');
      });
    });

    // Other event listeners (tabs, buttons, etc.) from original code...
    // (This would include all your existing event listeners for UI interactions)
  }

  function updateDateTime() {
    const now = new Date();
    const options = {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
      hour: '2-digit', minute: '2-digit', second: '2-digit'
    };
    elements.datetime.textContent = now.toLocaleDateString('en-US', options);
  }

  function renderCharts() {
    // Vehicle Type Chart
    const vehicleTypeCtx = document.getElementById('vehicleTypeChart').getContext('2d');
    state.vehicleTypeChart = new Chart(vehicleTypeCtx, {
      type: 'doughnut',
      data: {
        labels: ['6 WCV', '4 WCV'],
        datasets: [{
          data: [8, 4],
          backgroundColor: [
            getComputedStyle(document.documentElement).getPropertyValue('--wcv6-color'),
            getComputedStyle(document.documentElement).getPropertyValue('--wcv4-color')
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: 'Vehicle Type Distribution',
            color: getComputedStyle(document.documentElement).getPropertyValue('--text-color'),
            font: { size: 14 }
          },
          legend: {
            position: 'bottom',
            labels: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--text-color'),
              font: { size: 12 }
            }
          }
        },
        cutout: '60%',
        animation: {
          duration: 800,
          easing: 'easeOutQuart'
        }
      }
    });

    // Cost Chart
    const costCtx = document.getElementById('costChart').getContext('2d');
    state.costChart = new Chart(costCtx, {
      type: 'bar',
      data: {
        labels: ['Fuel', 'Parking', 'Tolls'],
        datasets: [{
          label: 'Average Cost (₱)',
          data: [1075, 300, 375],
          backgroundColor: ['#f39c12', '#3498db', '#27ae60'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: 'Trip Cost Analysis',
            color: getComputedStyle(document.documentElement).getPropertyValue('--text-color'),
            font: { size: 14 }
          },
          legend: { display: false }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--text-color'),
              callback: function (value) { return '₱' + value; },
              font: { size: 12 }
            },
            grid: { color: 'rgba(0, 0, 0, 0.1)' }
          },
          x: {
            ticks: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--text-color'),
              font: { size: 12 }
            },
            grid: { display: false }
          }
        },
        animation: {
          duration: 800,
          easing: 'easeOutQuart'
        }
      }
    });
  }

  // Initialize when DOM is loaded
  document.addEventListener('DOMContentLoaded', init);

  // Listen for auth state changes
  auth.onAuthStateChanged((user) => {
    if (user) {
      state.currentUser = user;
      elements.loginModal.style.display = 'none';
      elements.appContainer.style.display = 'block';

      // Set user avatar
      const email = user.email || 'A';
      const initials = email.charAt(0).toUpperCase();
      elements.userAvatar.textContent = initials;

      // Initialize Firebase listeners
      setupFirebaseListeners();
    } else {
      state.currentUser = null;
      elements.appContainer.style.display = 'none';
      elements.loginModal.style.display = 'flex';
    }
  });
</script>
</body>
</html>
